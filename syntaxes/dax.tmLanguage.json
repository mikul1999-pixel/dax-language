{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "DAX",
  "scopeName": "source.dax",
  "patterns": [
    {
      "include": "#define-keywords"
    },
    {
      "include": "#core-includes"
    }
  ],
  "repository": {
    "core-includes": {
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "include": "#strings"
        },
        {
          "include": "#numbers"
        },
        {
          "include": "#variable-declarations"
        },
        {
          "include": "#datatype-keywords"
        },
        {
          "include": "#other-keywords"
        },
        {
          "include": "#operators"
        },
        {
          "include": "#functions"
        },
        {
          "include": "#table-column-references"
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.dax",
          "match": "//.*$"
        },
        {
          "name": "comment.line.double-dash.dax",
          "match": "--.*$"
        },
        {
          "name": "comment.block.dax",
          "begin": "/\\*",
          "end": "\\*/"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.dax",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.dax",
              "match": "\"\""
            }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.dax",
          "match": "\\b\\d+(\\.\\d+)?([eE][+-]?\\d+)?\\b"
        }
      ]
    },
    "define-keywords": {
      "begin": "\\bDEFINE\\b",
      "beginCaptures": {
        "0": {
          "name": "keyword.control.define.dax"
        }
      },
      "end": "\\bEVALUATE\\b",
      "endCaptures": {
        "0": {
          "name": "keyword.control.evaluate.dax"
        }
      },
      "patterns": [
        {
          "match": "(?i)^\\s*\\b(MEASURE|COLUMN|TABLE)\\b",
          "name": "keyword.definition.dax"
        },
        {
          "include": "#core-includes"
        }
      ]
    },
    "datatype-keywords": {
      "begin": "\\bDATATABLE\\s*\\(",
      "beginCaptures": {
        "0": {
          "name": "support.function.datatable.dax"
        }
      },
      "end": "\\)",
      "patterns": [
        {
          "match": "(?i)\\b(DATETIME|CURRENCY|INTEGER|BOOLEAN|STRING|DOUBLE)\\b",
          "name": "storage.type.datatable.dax"
        }
      ]
    },
    "other-keywords": {
      "patterns": [
        {
          "name": "keyword.control.dax",
          "match": "(?i)\\b(PARTITION\\s+BY|ORDER\\s+BY|START\\s+AT|EVALUATE|MATCHBY|RETURN|DEFINE|DESC|VAR|ASC)\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.control.operator.word.dax",
          "match": "(?i)\\b(IN)\\b"
        },
        {
          "name": "keyword.control.operator.word.dax",
          "match": "(?i)\\bNOT\\b(?!\\s*\\()"
        },
        {
          "name": "keyword.operator.comparison.dax",
          "match": "(==|<>|!=|<=|>=|=|<|>)"
        },
        {
          "name": "keyword.operator.logical.dax",
          "match": "(&&|\\|\\|)"
        },
        {
          "name": "keyword.operator.arithmetic.dax",
          "match": "(\\+|-|\\*|/|\\^)"
        },
        {
          "name": "keyword.operator.assignment.dax",
          "match": ":="
        },
        {
          "name": "keyword.operator.concatenation.dax",
          "match": "&"
        }
      ]
    },
    "functions": {
      "patterns": [
        {
          "name": "support.function.constant.dax",
          "match": "(?i)\\b(TRUE|FALSE|BLANK)\\s*(?=\\()"
        },
        {
          "name": "support.function.math.dax",
          "match": "(?i)\\b(RANDBETWEEN|ROUNDDOWN|CURRENCY|QUOTIENT|CEILING|RADIANS|ROUNDUP|DIVIDE|ISEVEN|ACOSH|ACOTH|ASINH|ATANH|FLOOR|ISODD|LOG10|POWER|ROUND|TRUNC|ACOS|ACOT|ASIN|ATAN|FACT|RAND|SIGN|SQRT|ABS|EXP|INT|LOG|MOD|SIN|LN)\\s*(?=\\()"
        },
        {
          "name": "support.function.table.dax",
          "match": "(?i)\\b(NATURALLEFTOUTERJOIN|NATURALINNERJOIN|SUMMARIZECOLUMNS|ADDMISSINGITEMS|GENERATESERIES|SELECTCOLUMNS|CURRENTGROUP|CONTAINSROW|GENERATEALL|ADDCOLUMNS|CROSSJOIN|DATATABLE|INTERSECT|SUMMARIZE|CONTAINS|DISTINCT|GENERATE|GROUPBY|TREATAS|EXCEPT|IGNORE|UNION|TOPN|ROW)\\s*(?=\\()"
        },
        {
          "name": "support.function.filter.dax",
          "match": "(?i)\\b(ALLCROSSFILTERED|CALCULATETABLE|ALLNOBLANKROW|REMOVEFILTERS|SELECTEDVALUE|HASONEFILTER|ALLSELECTED|HASONEVALUE|KEEPFILTERS|LOOKUPVALUE|ALLEXCEPT|CALCULATE|FILTERS|FILTER|VALUES|ALL)\\s*(?=\\()"
        },
        {
          "name": "support.function.logical.dax",
          "match": "(?i)\\b(COALESCE|IFERROR|SWITCH|FALSE|TRUE|AND|NOT|IF|OR)\\s*(?=\\()"
        },
        {
          "name": "support.function.aggregation.dax",
          "match": "(?i)\\b(APPROXIMATEDISTINCTCOUNT|DISTINCTCOUNT|COUNTBLANK|COUNTROWS|AVERAGEA|AVERAGEX|PRODUCTX|AVERAGE|COUNTAX|PRODUCT|COUNTA|COUNTX|COUNT|MAXA|MAXX|MINA|MINX|SUMX|MAX|MIN|SUM)\\s*(?=\\()"
        },
        {
          "name": "support.function.other.dax",
          "match": "(?i)\\b(CUSTOMDATA|EARLIEST|EARLIER|BLANK|ERROR)\\s*(?=\\()"
        },
        {
          "name": "support.function.date.dax",
          "match": "(?i)\\b(CALENDARAUTO|DATEVALUE|TIMEVALUE|CALENDAR|DATEDIFF|UTCTODAY|YEARFRAC|EOMONTH|QUARTER|WEEKDAY|WEEKNUM|MINUTE|SECOND|UTCNOW|EDATE|MONTH|TODAY|DATE|HOUR|TIME|YEAR|DAY|NOW)\\s*(?=\\()"
        },
        {
          "name": "support.function.text.dax",
          "match": "(?i)\\b(CONTAINSSTRING|COMBINEVALUES|CONCATENATEX|CONCATENATE|SUBSTITUTE|REPLACE|FORMAT|SEARCH|EXACT|FIXED|LOWER|RIGHT|UPPER|VALUE|FIND|LEFT|REPT|TRIM|LEN|MID)\\s*(?=\\()"
        },
        {
          "name": "support.function.relationship.dax",
          "match": "(?i)\\b(USERELATIONSHIP|RELATEDTABLE|CROSSFILTER|RELATED)\\s*(?=\\()"
        },
        {
          "name": "support.function.time-intelligence.dax",
          "match": "(?i)\\b(FIRSTNONBLANKVALUE|SAMEPERIODLASTYEAR|LASTNONBLANKVALUE|PREVIOUSQUARTER|PARALLELPERIOD|STARTOFQUARTER|DATESINPERIOD|FIRSTNONBLANK|PREVIOUSMONTH|DATESBETWEEN|ENDOFQUARTER|LASTNONBLANK|PREVIOUSYEAR|STARTOFMONTH|NEXTQUARTER|PREVIOUSDAY|STARTOFYEAR|ENDOFMONTH|ENDOFYEAR|FIRSTDATE|NEXTMONTH|DATESMTD|DATESQTD|DATESYTD|LASTDATE|NEXTYEAR|TOTALMTD|TOTALQTD|TOTALYTD|DATEADD|NEXTDAY)\\s*(?=\\()"
        },
        {
          "name": "support.function.information.dax",
          "match": "(?i)\\b(USERPRINCIPALNAME|ISCROSSFILTERED|ISFILTERED|ISINSCOPE|ISLOGICAL|ISNONTEXT|ISNUMBER|USERNAME|ISBLANK|ISEMPTY|ISERROR|ISTEXT)\\s*(?=\\()"
        },
        {
          "name": "support.function.statistical.dax",
          "match": "(?i)\\b(MEDIANX|MEDIAN|VARX\\.P|VARX\\.S|RANKX|VAR\\.P|VAR\\.S)\\s*(?=\\()"
        },
        {
          "name": "support.function.parent-child.dax",
          "match": "(?i)\\b(PATHITEMREVERSE|PATHCONTAINS|PATHLENGTH|PATHITEM|PATH)\\s*(?=\\()"
        }
      ]
    },
    "variable-declarations": {
      "match": "(?i)\\b(var)\\s+([A-Za-z_][A-Za-z0-9_]*)\\s*(=)",
      "captures": {
        "1": {
          "name": "keyword.control.var.dax"
        },
        "2": {
          "name": "variable.other.constant.declaration.dax"
        },
        "3": {
          "name": "keyword.operator.assignment.dax"
        }
      }
    },
    "table-column-references": {
      "patterns": [
        {
          "begin": "(\\b\\w+|'[^']+')\\s*\\[",
          "end": "\\]",
          "beginCaptures": {
            "1": {
              "patterns": [
                {
                  "match": "'([^']+)'",
                  "captures": {
                    "1": {
                      "name": "entity.name.type.table.dax"
                    }
                  }
                },
                {
                  "match": "\\b\\w+",
                  "name": "entity.name.type.table.dax"
                }
              ]
            }
          },
          "patterns": [
            {
              "name": "constant.other.column.dax",
              "match": "[^\\]]+"
            }
          ]
        },
        {
          "name": "variable.other.measure.dax",
          "match": "\\[[^\\]]+\\]"
        }
      ]
    }
  }
}